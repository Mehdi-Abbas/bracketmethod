<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bracketing Method</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* background-color: powderblue; */
            font-family: 'Courier New', Courier;
        }

        .box {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 10px;
            background-color: rgb(222, 184, 135);
            border-radius: 10px;
            margin: 9px 20px;

        }

        .box input {
            padding: 10px;
            font-size: 1rem;
            border-radius: 10px;
            width: 100%;

        }

        .box label {
            font-size: 1rem;
            font-weight: bold;
            margin-left: 5px;
        }

        .box #btn {
            width: 80%;
            margin-left: 10%;
            background-color: rgb(85, 138, 78);
            color: white;
            font-weight: bold;


        }

        .box #btn-reset {
            width: 80%;
            margin-left: 10%;
            background-color: rgb(11, 105, 228);
            color: white;
            font-weight: bold;
            margin-top: 8px;


        }

        .answer {
            max-width: 90%;
            overflow: hidden;
            padding: 10px;
            background-color: rgb(236, 219, 122);
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            border: 2px solid rgb(126, 119, 79)
        }

        .answer label {
            font-size: 1.2rem;
        }

        .answer p {
            font-size: 2rem;
        }

        .hide {
            display: none;
        }

        .show {
            display: block;
        }

        .table {
            font-family: Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 90%;
            margin: 20px auto;
            overflow: scroll;
        }

        .table td,
        .table th {
            border: 1px solid#000;
            padding: 2px;
            text-align: center;
        }

        .table th {
            padding-top: 12px;
            padding-bottom: 12px;
            /* text-align: left; */
            background-color: rgb(102, 154, 231);
            color: black;
        }
    </style>
</head>

<body>
    <div id="main">
        <div class="box">
            <form action="">
                <label for="eqn">Equation: </label>
                <input id="eqn" type="text" placeholder="e.g. 3x^3-2x^2+1 => `3,-2,0,1`"><br><br>
                <label for="interval">Interval: </label>
                <input id="interval" type="text" placeholder="e.g. (1,7) => `1,7`"><br><br>
                <label for="interval">Error: </label>
                <input id="err" type="number" placeholder="e.g. 10% => 10"><br><br>
                <label for="interval">Max iterations: </label>
                <input id="itr" type="number" placeholder="e.g. 7"><br><br>
                <label for="interval">Decimal places: </label>
                <input id="dec" type="number" placeholder="e.g. 2.3465 => 4"><br><br>
                <input id="btn" class="btn" type="button" value="Get answer">
                <input id="btn-reset" class="btn hide" type="button" value="Reset">
            </form>
        </div>
        <div id="answer" class="answer hide">
            <label>Answer</label>
            <p id="ans"></p>
        </div>
        <div id="table" class="table hide">


        </div>
    </div>

</body>
<script>
    let main = document.getElementById("main")
    let tableStr = `
            <table>
                <tr>
                    <th>iteration</th>
                    <th>x<sub>L</sub></th>
                    <th>x<sub>u</sub></th>
                    <th>f(x<sub>u</sub>)</th>
                    <th>f(x<sub>L</sub>)</th>
                    <th>x<sub>r</sub></th>
                    <th>f(x<sub>r</sub>)</th>
                    <th>error</th>
                </tr>`

    function getY(coeffs, x) {

        let n = 0
        let exp = coeffs.length - 1
        for (i = 0; i < coeffs.length; i++) {
            n += (coeffs[i] * (x ** exp))
            exp--
        }
        return n
    }
    function getDiff(num1, num2) {
        let temp = Math.abs((num1 - num2) / num1) * 100
        temp = Math.trunc(temp)
        return temp
    }
    function getcenter(num1, num2) {
        return ((num1 + num2) / 2)
    }
    let s = 1
    function findRoots(coeffs, interval, err, itr, dec) {
        if (getY(coeffs, interval[0]) * getY(coeffs, interval[1]) < 0) {
            tableStr += `
                <tr>
                    <td>${s}</td>
                    <td>${interval[0].toFixed(dec)}</td>
                    <td>${interval[1].toFixed(dec)}</td>
                    <td>${getY(coeffs, interval[0]).toFixed(dec)}</td>
                    <td>${getY(coeffs, interval[1]).toFixed(dec)}</td>
                    <td>${getcenter(interval[0], interval[1]).toFixed(dec)}</td>
                    <td>${getY(coeffs, getcenter(interval[0], interval[1])).toFixed(dec)}</td>
                    <td>${getDiff(getcenter(interval[0], interval[1]), interval[interval[2]]) + "%"}</td>
                </tr>`
            s++
            if (getDiff(getcenter(interval[0], interval[1]), interval[interval[2]]) < err ||
                itr <= 0) {
                console.log("err: " + err + " error: " + getDiff(getcenter(interval[0], interval[1]), interval[interval[2]]))
                return getcenter(interval[0], interval[1]).toFixed(dec)
            }
            else {



                let center = getcenter(interval[0], interval[1])//center
                console.log("interval: " + interval)
                console.log("err: " + err + " error: " + getDiff(getcenter(interval[0], interval[1]), interval[interval[2]]))
                console.log("center: " + getcenter(interval[0], interval[1]).toFixed(dec))

                if (getY(coeffs, interval[0]) * getY(coeffs, center) < 0) {
                    interval[1] = center
                    interval[2] = 1
                }
                else if (getY(coeffs, interval[0]) * getY(coeffs, center) > 0) {
                    interval[0] = center
                    interval[2] = 0
                }
                else {
                    err = 10000 //making error infinite to stop iteration
                }


                return findRoots(coeffs, interval, err, itr - 1, dec)
            }
        }
        else if (document.getElementById("eqn").value === "") {
            document.getElementById("ans").style.fontSize = "1rem"
            return "Enter query first!"
        }
        else if (getY(coeffs, interval[0]) * getY(coeffs, interval[1]) > 0) {
            document.getElementById("ans").style.fontSize = "1rem"
            console.log("inte: " + interval)
            console.log("fxl: " + getY(coeffs, interval[0]) + " fxu: " + getY(coeffs, interval[1]))
            return "Interval must contain only a single root!"
        }

        else {
            document.getElementById("ans").style.fontSize = "1rem"
            return "Root is either one of given interval point"
        }
    }



    let button = document.getElementById("btn")
    button.addEventListener("click", (e) => {
        e.preventDefault()
        s = 1
        tableStr = `
            <table>
                <tr>
                    <th>iteration</th>
                    <th>x<sub>L</sub></th>
                    <th>x<sub>u</sub></th>
                    <th>f(x<sub>u</sub>)</th>
                    <th>f(x<sub>L</sub>)</th>
                    <th>x<sub>r</sub></th>
                    <th>f(x<sub>r</sub>)</th>
                    <th>error</th>
                </tr>`
        let coeffs = document.getElementById("eqn").value
        coeffs = coeffs.split(",")
        coeffsInt = []
        for (i in coeffs) {
            coeffsInt.push(parseFloat(coeffs[i]))
        }
        let interval = document.getElementById("interval").value
        interval = interval.split(",")
        intervalInt = []
        for (i in interval) {
            intervalInt.push(parseFloat(interval[i]))
        }
        intervalInt.push(0)
        let err = document.getElementById("err").value
        err = parseFloat(err)

        let itr = document.getElementById("itr").value
        itr = parseInt(itr)
        let dec = document.getElementById("dec").value
        dec = parseInt(dec)

        let root = findRoots(coeffsInt, intervalInt, err, itr, dec)
        tableStr += `</table>`
        document.getElementById("table").innerHTML = tableStr
        document.getElementById("ans").innerText = root

        let answer = document.getElementById("answer")
        answer.classList.replace("hide", "block")
        document.getElementById("btn-reset").classList.replace("hide", "block")

        let table = document.getElementById("table")
        table.classList.replace("hide", "block")

        document.getElementById('table').scrollIntoView();
    })
    document.getElementById("btn-reset").addEventListener("click", (e) => {
        e.preventDefault()
        document.getElementById("eqn").value = ""
        document.getElementById("interval").value = ""
        document.getElementById("err").value = ""
        document.getElementById("itr").value = ""
        document.getElementById("dec").value = ""
        answer.classList.replace("block", "hide")
        document.getElementById("ans").style.fontSize = "2rem"
        document.getElementById("btn-reset").classList.replace("block", "hide")
        document.getElementById("table").classList.replace("block", "hide")
    })

</script>

</html>